---
title: Hive的安装和使用
summary: ubuntu下Hive的安装和配置
date: 2019-5-18 13:25
urlname: 2019051903
author: foochane
categories: 大数据
tags:
  - hadoop
  - 大数据
---



<!-- 
###  用到的安装包： 
- apache-hive-3.1.1-bin.tar.gz
- mysql-connector-java-5.1.40.tar.gz -->


## 1 安装并配置MySQL

### 1.1 安装MySQL

```
$ sudo apt install mysql-server
```

### 1.2 配置MySQL JDBC驱动

```
$ tar -zxf mysql-connector-java-5.1.40.tar.gz 
$ cp mysql-connector-java-5.1.40/mysql-connector-java-5.1.40-bin.jar /usr/local/hive/lib/
```

### 1.3 设置MySQL的root用户密码
如果没有设置密码的话，设置密码。

这里密码设置为`hadoop`
```
$ mysql -u root -p
```

### 1.4 在MySQL中为Hive新建数据库

用来存放Hive的元数据。

与Hive配置文件`hive-site.xml`中的 `mysql://localhost:3306/hive` 对应

```
#建立数据库
mysql> create database if not exists hive;

#设置远程登录的权限
mysql> GRANT ALL PRIVILEGES ON *.* TO root@'%' IDENTIFIED BY 'hadoop' WITH GRANT OPTION;

mysql> #GRANT ALL PRIVILEGES ON hive.* TO hive@localhost IDENTIFIED BY '123456';


#刷新配置
mysql> FLUSH PRIVILEGES;
```

## 2 安装hive

```

$ tar -zxf apache-hive-1.2.1-bin.tar.gz -C /usr/local & cd /usr/local
$ mv apache-hive-1.2.1-bin hive

$ sudo chown -R hadoop:hadoop hive
$ cd /usr/local/hive/conf
$ cp hive-default.xml.template hive-site.xml
$ cp hive-env.sh.template hive-env.sh
$ cp hive-log4j.properties.template hive-log4j.properties
```



修改配置文件

### 2.1 hive-site.xml

修改如下内容：
```
<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<?xml-stylesheet type="text/xsl" href="configuration.xsl"?>
<configuration>
  <property>
    <name>javax.jdo.option.ConnectionURL</name>
    <value>jdbc:mysql://localhost:3306/hive?createDatabaseIfNotExist=true&amp;useSSL=true;</value>
    <description>JDBC connect string for a JDBC metastore</description>
  </property>
  <property>
    <name>javax.jdo.option.ConnectionDriverName</name>
    <value>com.mysql.jdbc.Driver</value>
    <description>Driver class name for a JDBC metastore</description>
  </property>
  <property>
    <!-- 所链接的mysql的用户名 -->
    <!-- 这里用root用户报错，就新建了一个名hive用户-->
    <name>javax.jdo.option.ConnectionUserName</name>
    <value>hive</value>
    <description>username to use against metastore database</description>
  </property>
  <property>
    <!-- mysql密码 -->
    <name>javax.jdo.option.ConnectionPassword</name>
    <value>123456</value>
    <description>password to use against metastore database</description>
  </property>

    <property>
    <name>hive.metastore.schema.verification</name>
    <value>false</value>
    <description>
      Enforce metastore schema version consistency.
      True: Verify that version information stored in metastore matches with one from Hive jars.  Also disable automatic
            schema migration attempt. Users are required to manually migrate schema after Hive upgrade which ensures
            proper metastore schema migration. (Default)
      False: Warn if the version information stored in metastore doesn't match with one from in Hive jars.
    </description>
  </property>

</configuration>
```



### 2.2 hive-env .sh

添加：

```
export HADOOP_HOME=/usr/local/hadoop
export HIVE_CONF_DIR=/usr/local/hive/conf
```

### 2.3 hive-log4j.properties

```
hive.log.threshold=ALL
hive.root.logger=INFO,DRFA
hive.log.dir= /usr/local/hive/log
hive.log.file=hive.log
```

### 2.4 配置环境变量

在` ~/.bashrc`文件中添加如下内容，执行`source ~/.bashrc`使其生效。

```
export HIVE_HOME=/usr/local/hive
export PATH=$PATH:$HIVE_HOME/bin
```

## 3 启动hive

```
$ start-dfs.sh  # 先启动集群

$ schematool -dbType mysql -initSchema
$ hive

```

## 4 出现的问题

错误：
```
org.apache.hadoop.hive.metastore.HiveMetaException: Failed to get schema version.
*** schemaTool failed ***
```

解决：

可能是权限问题，不使用root用户，新建一个名为hive的用户。
```
$ sudo mysql  -u root -p
mysql> create user 'hive'@'%' identified by '123456';  
mysql> grant all privileges on `hive`.* to 'hive'@'%' identified by '123456';  
mysql> flush privileges;
```





