---
title: Hadoop集群下HDFS的文件操作
summary: HDFS文件系统的基本操作，hadoop基本命令的使用
date: 2019-5-19 11:45
author: foochane
img: 
urlname: 2019051902
categories: 大数据
toc: true
tags:
  - hadoop
  - 大数据
---




## 1 创建用户目录

```bash
$ hdfs dfs -mkdir -p /user/hadoop # -p 表示创建多级目录
```

查看刚刚创建的目录：

```bash
$ hdfs dfs -ls /
Found 2 items
drwxrwx---   - hadoop supergroup          0 2019-04-20 09:59 /tmp
drwxr-xr-x   - hadoop supergroup          0 2019-04-21 01:41 /user
$ hdfs dfs -ls /user
Found 1 items
drwxr-xr-x   - hadoop supergroup          0 2019-04-21 01:41 /user/hadoop

```

```bash
$ hdfs dfs -mkdir input # input 为相对路径
$ hdfs dfs -ls /user/hadoop
Found 1 items
drwxr-xr-x   - hadoop supergroup          0 2019-04-21 01:46 /user/hadoop/input
```

删除操作：

**注意：hadoop-2.x是可以用`$ hdfs dfs -rm -r /input` ，hadoop-3.x不行。**

```
$ hdfs dfs -rm -r /user/hadoop/input # -r 表示删 除子目录
```

## 2 文件操作

上传文件
```
$ hdfs dfs -mkdir test # 文件夹创建在/user/hadoop下
$ hdfs dfs -put /home/hadoop/test.txt /user/hadoop/test #上传文件到HDFS
$ hdfs dfs -ls test
Found 1 items
-rw-r--r--   3 hadoop supergroup        156 2019-04-21 01:59 test/test.txt
```

下载文件到本地
```shell
$ hdfs dfs -get test/test.txt /home/hadoop/Downloads
```


## 问题

###问题1
```
hadoop@Master:~$ hdfs dfs -put ./work.csv /pyspark
19/06/10 07:51:24 WARN hdfs.DFSClient: DataStreamer Exception
org.apache.hadoop.ipc.RemoteException(java.io.IOException): File /pyspark/work.csv._COPYING_ could only be replicated to 0 nodes instead of minReplication (=1).  There are 0 datanode(s) running and no node(s) are excluded in this operation.
        at org.apache.hadoop.hdfs.server.blockmanagement.BlockManager.chooseTarget4NewBlock(BlockManager.java:1550)
        at org.apache.hadoop.hdfs.server.namenode.FSNamesystem.getNewBlockTargets(FSNamesystem.java:3110)
        at org.apache.hadoop.hdfs.server.namenode.FSNamesystem.getAdditionalBlock(FSNamesystem.java:3034)
        at org.apache.hadoop.hdfs.server.namenode.NameNodeRpcServer.addBlock(NameNodeRpcServer.java:723)
        at org.apache.hadoop.hdfs.protocolPB.ClientNamenodeProtocolServerSideTranslatorPB.addBlock(ClientNamenodeProtocolServerSideTranslatorPB.java:492)
        at org.apache.hadoop.hdfs.protocol.proto.ClientNamenodeProtocolProtos$ClientNamenodeProtocol$2.callBlockingMethod(ClientNamenodeProtocolProtos.java)
        at org.apache.hadoop.ipc.ProtobufRpcEngine$Server$ProtoBufRpcInvoker.call(ProtobufRpcEngine.java:616)
        at org.apache.hadoop.ipc.RPC$Server.call(RPC.java:969)
        at org.apache.hadoop.ipc.Server$Handler$1.run(Server.java:2049)
        at org.apache.hadoop.ipc.Server$Handler$1.run(Server.java:2045)
        at java.security.AccessController.doPrivileged(Native Method)
        at javax.security.auth.Subject.doAs(Subject.java:422)
        at org.apache.hadoop.security.UserGroupInformation.doAs(UserGroupInformation.java:1657)
        at org.apache.hadoop.ipc.Server$Handler.run(Server.java:2043)

        at org.apache.hadoop.ipc.Client.call(Client.java:1476)
        at org.apache.hadoop.ipc.Client.call(Client.java:1407)
        at org.apache.hadoop.ipc.ProtobufRpcEngine$Invoker.invoke(ProtobufRpcEngine.java:229)
        at com.sun.proxy.$Proxy9.addBlock(Unknown Source)
        at org.apache.hadoop.hdfs.protocolPB.ClientNamenodeProtocolTranslatorPB.addBlock(ClientNamenodeProtocolTranslatorPB.java:418)
        at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
        at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:62)
        at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
        at java.lang.reflect.Method.invoke(Method.java:498)
        at org.apache.hadoop.io.retry.RetryInvocationHandler.invokeMethod(RetryInvocationHandler.java:187)
        at org.apache.hadoop.io.retry.RetryInvocationHandler.invoke(RetryInvocationHandler.java:102)
        at com.sun.proxy.$Proxy10.addBlock(Unknown Source)
        at org.apache.hadoop.hdfs.DFSOutputStream$DataStreamer.locateFollowingBlock(DFSOutputStream.java:1430)
        at org.apache.hadoop.hdfs.DFSOutputStream$DataStreamer.nextBlockOutputStream(DFSOutputStream.java:1226)
        at org.apache.hadoop.hdfs.DFSOutputStream$DataStreamer.run(DFSOutputStream.java:449)
put: File /pyspark/work.csv._COPYING_ could only be replicated to 0 nodes instead of minReplication (=1).  There are 0 datanode(s) running and no node(s) are excluded in this operation.
```

##### 解决
Slave节点没有启动，或者有防火墙，启动Slave节点，或者关闭防火墙。

<!-- >本文作者：[foochane](https://foochane.cn/) 
本文链接：[https://foochane.cn/article/2019051902.html](https://foochane.cn/article/2019051902.html) -->