---
title: SSR安装教程1
summary: 
author: foochane
top: false
cover: false
categories: linux
date: 2019-08-08 18:26
urlname: 2019080801
tags:
  - linux
---

## 1 Shadowsocks的安装及配置

### 1.1 安装Shadowsocks
```
$ sudo apt install python-pip
$ pip install shadowsocks
```

### 1.2 配置Shadowsocks

在`/etc`目录下创建一个`shadowsocks.json`文件

在`/etc/shadowsocks.json`文件中添加如下内容：

```json
{                                  
    "server":"my_server_ip",          //服务器的IP地址
    "server_port":7711,              //服务器的端口
    "local_address": "127.0.0.1",       //本机IP地址
    "local_port":1080,               //本机端口
    "password":"mypassword",        //自己设定的密码
    "timeout":300,                  //超出时间
    "method":"aes-256-cfb",          //加密方法，推荐使用"aes-256-cfb"
    "fast_open": false                //true 或 false}
}
```
<!-- ```json
{                                  
    "server":"170.106.5.40",          //服务器的IP地址
    "server_port":22,              //服务器的端口
    "local_address": "127.0.0.1",       //本机IP地址
    "local_port":1080,               //本机端口
    "password":"mypassword",        //自己设定的密码
    "timeout":300,                  //超出时间
    "method":"aes-256-cfb",          //加密方法，推荐使用"aes-256-cfb"
    "fast_open": false                //true 或 false}
}
``` -->
### 1.3 Shadowsocks服务端启动
```
$ sudo sslocal -c /etc/shadowsocks.json -d start

```
或者使用`ssserver`命令也行。
```
$ sudo ssserver -c /etc/shadowsocks.json -d start

```
## 2 ShadowsocksR安装

### 2.1 下载安装脚步

```bash
$ wget https://github.com/the0demiurge/CharlesScripts/raw/master/charles/bin/ssr

```

里面封装了 SSR 的安装、配置、启动、关闭等功能。

为了方便操作，我们将脚本放进`/usr/local/bin`中
```bash
$ sudo mv ssr /usr/local/bin
$ sudo chmod 766 /usr/local/bin/ssr

```
接下来我们通过脚本安装SSR

### 2.2 安装ShadowsocksR
```
$ ssr install

```
脚本的默认安装目录是`$HOME/.local/share/shadowsocksr`,配置文件的配置信息放在安装目录下的`config.json`中
### 2.3 配置ShadowsocksR
```
$ ssr config
```

```json
{
    "server": "{your-server}", // 服务器ip
    "server_ipv6": "::",
    "server_port": 8088,	// 服务器端口
    "local_address": "127.0.0.1",
    "local_port": 1080, // 本地端口，记住这个，后续Privoxy将代理这个端口

    "password": "{passwd}", // 服务器密码
    "method": "AES-256-CFB", // 加密方式
    "protocol": "origin", // 加密协议
    "protocol_param": "",
    "obfs": "plain", // 混淆方式
    "obfs_param": "",
    "speed_limit_per_con": 0,
    "speed_limit_per_user": 0,

    "additional_ports" : {}, // only works under multi-user mode
    "additional_ports_only" : false, // only works under multi-user mode
    "timeout": 120,
    "udp_timeout": 60,
    "dns_ipv6": false,
    "connect_verbose_info": 0,
    "redirect": "",
    "fast_open": false
}
```
<!-- 
```json
{
    "server": "170.106.5.40", // 服务器ip
    "server_ipv6": "::",
    "server_port": 22,	// 服务器端口
    "local_address": "127.0.0.1",
    "local_port": 1080, // 本地端口，记住这个，后续Privoxy将代理这个端口

    "password": "ntdtv.com", // 服务器密码
    "method": "AES-256-CFB", // 加密方式
    "protocol": "origin", // 加密协议
    "protocol_param": "",
    "obfs": "plain", // 混淆方式
    "obfs_param": "",
    "speed_limit_per_con": 0,
    "speed_limit_per_user": 0,

    "additional_ports" : {}, // only works under multi-user mode
    "additional_ports_only" : false, // only works under multi-user mode
    "timeout": 120,
    "udp_timeout": 60,
    "dns_ipv6": false,
    "connect_verbose_info": 0,
    "redirect": "",
    "fast_open": false
}
``` -->


## 3 安装proxychins4
根据上一节末的提示信息(You may install proxychains4 and configure it properly to test net delay)可知没有安装proxychins4所以无法进行延迟测试

### 3.1 克隆proxychins-ng
```
$ git clone https://github.com/rofl0r/proxychains-ng.git

```
### 3.2 安装
```
$ cd proxychains-ng
$ ./configure --prefix=/usr --sysconfdir=/etc
$ make
$ sudo make install
$ sudo make install-config

```

### 3.3 修改配置文件
```
$ sudo vi /etc/proxychains.conf


```
proxychains默认使用的是`9050`端口，而我们SSR配置中使用的是`1080`端口，所以要将配置文件最底部的`socks4 127.0.0.1 9050`改为`socks4 127.0.0.1 1080`

安装完成后再次运行ssr test即可看到延迟测试信息了




## 4 Privoxy安装

### 4.1 安装privoxy
```
$ sudo apt-get install privoxy 

```

### 4.2 配置privoxy

#### 4.2.1 全局模式
代理模式同其他平台上方式，将所有http/https请求走代理服务，如果需要全局代理的话按照如下操作即可，如果要使用PAC模式，请跳过此部分。

添加本地ssr服务到配置文件
```
# echo 'forward-socks5 / 127.0.0.1:1080 .' >> /etc/privoxy/config
```


#### 4.2.2 PAC模式

进行全局代理会大大的影响我们访问国内地址，所以我们使用PAC模式来进行流量代理。根据GFWList(由AutoProxy官方维护)来判断哪些网站被我们的超级安全防御墙（超级ma fan的wall）挡在门外

这里我们使用@Otokaze 的shell自动转换脚本来获取GFWList配置

先获取脚本

```
wget https://github.com/SAMZONG/gfwlist2privoxy/raw/master/gfwlist2privoxy

```
执行脚本

```
bash gfwlist2privoxy

```
这里会提示需要输入ip地址及端口，输入你ssr配置的本地地址及端口即可，测试内容如下：

```
$ bash gfwlist2privoxy
proxy(socks5): 127.0.0.1:1080
{+forward-override{forward-socks5 127.0.0.1：1080 .}}

=================================================================

"cp -af /root/gfw.action /etc/privoxy/"
```

然后执行：
```
sudo cp -af gfw.action /etc/privoxy/

```

修改/etc/privoxy/config文件在最后添加如下如下内容：
```
actionsfile gfw.action

```

### 4.3 设置http、https监听的端口及不监听的端口
在`.bashrc文件中添加如下，内容 `source ~/.bashrc`使其生效
```
# privoxy默认监听端口为8118
export http_proxy=http://127.0.0.1:8118
export https_proxy=http://127.0.0.1:8118
export no_proxy=localhost

# no_proxy是不经过privoxy代理的地址
# 只能填写具体的ip、域名后缀，多个条目之间使用','逗号隔开
# 比如: export no_proxy="localhost, 192.168.1.1, ip.cn, chinaz.com"
# 访问 localhost、192.168.1.1、ip.cn、*.ip.cn、chinaz.com、*.chinaz.com 将不使用代理

```


### 4.4 启动服务
```
sudo systemctl start privoxy.service

```

## 5 测试
```
# 访问各大网站，如果都有网页源码输出说明代理没问题
curl -sL www.baidu.com
curl -sL www.google.com
curl -sL www.google.com.hk
curl -sL www.google.co.jp
curl -sL www.youtube.com
curl -sL mail.google.com
curl -sL facebook.com
curl -sL twitter.com
curl -sL www.wikipedia.org

# 获取当前 IP 地址
# 如果使用 privoxy 全局模式，则应该显示 ss 服务器的 IP
# 如果使用 privoxy gfwlist模式，则应该显示本地公网 IP
curl -sL ip.chinaz.com/getip.aspx
```


参考：
https://smileorigin.site/2018/12/21/Linux/Linux%20SSR/


